name: SpringBoot Setup & Maven Install

on:
  workflow_dispatch:

jobs:
  setup-springboot:
    runs-on: ubuntu-latest

    steps:
      # 1. GitHub Repository Checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Create disk slot structure for organized storage
      - name: Create disk slot structure
        run: |
          mkdir -p ~/springboot-slots/slot1/bin
          mkdir -p ~/springboot-slots/slot1/config
          mkdir -p ~/springboot-slots/slot1/logs
          echo "âœ… ë””ìŠ¤í¬ ìŠ¬ë¡¯ ë””ë ‰í„°ë¦¬ ìƒì„± ì™„ë£Œ"

      # 3. Install latest Maven version into slot
      - name: Install Maven (v3.9.6)
        run: |
          MAVEN_VERSION=3.9.6
          curl -sL https://downloads.apache.org/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.zip -o maven.zip
          unzip -q maven.zip -d ~/springboot-slots/slot1/bin
          echo "MAVEN_HOME=$HOME/springboot-slots/slot1/bin/apache-maven-${MAVEN_VERSION}" >> $GITHUB_ENV
          echo "PATH=$HOME/springboot-slots/slot1/bin/apache-maven-${MAVEN_VERSION}/bin:$PATH" >> $GITHUB_ENV
          echo "âœ… Maven ${MAVEN_VERSION} ì„¤ì¹˜ ì™„ë£Œ"

      # 4. Confirm Maven works
      - name: Verify Maven version
        run: mvn -v

      # 5. Build the Spring Boot project
      - name: Build Spring Boot app
        run: |
          cd ./your-project-dir  # ðŸ” ê¼­ ìˆ˜ì •: pom.xmlì´ ìœ„ì¹˜í•œ ë””ë ‰í„°ë¦¬ë¡œ ë³€ê²½í•˜ì„¸ìš”
          mvn clean package -DskipTests
          cp target/*.jar ~/springboot-slots/slot1/bin/app.jar
          echo "âœ… JAR íŒŒì¼ ë¹Œë“œ ë° ìŠ¬ë¡¯ ë³´ê´€ ì™„ë£Œ"

      # 6. Copy config files to slot
      - name: Store configuration
        run: |
          cp -r ./your-project-dir/src/main/resources/* ~/springboot-slots/slot1/config/
          echo "âœ… ì„¤ì • íŒŒì¼ ë³µì‚¬ ì™„ë£Œ"

      # 7. Run the Spring Boot JAR file in background
      - name: Run Spring Boot app (background)
        run: |
          nohup java -jar ~/springboot-slots/slot1/bin/app.jar > ~/springboot-slots/slot1/logs/server.log 2>&1 &
          echo "âœ… ì„œë²„ ì‹¤í–‰ ì¤‘ (ë°±ê·¸ë¼ìš´ë“œ)"

      # 8. View final slot structure
      - name: Show disk slot layout
        run: |
          sudo apt-get install -y tree > /dev/null
          tree ~/springboot-slots/slot1 || find ~/springboot-slots/slot1
