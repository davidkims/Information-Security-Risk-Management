name: “Automated Scheduled Builds with Massive Retry”

# 3분마다 자동 실행
on:
  schedule:
    - cron: '*/3 * * * *'

jobs:
  build-loop:
    runs-on: ubuntu-latest
    env:
      TOTAL_RUNS: 99999           # 총 반복 횟수
      MAX_RETRIES: 900000000      # 실패 시 최대 재시도 횟수
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Maven build + huge retry loop
        run: |
          #!/usr/bin/env bash
          set -euo pipefail

          for run_index in $(seq 1 $TOTAL_RUNS); do
            echo "=== Run #${run_index}/${TOTAL_RUNS} ==="
            attempt=0

            # until 빌드 성공, MAX_RETRIES 번까지 재시도
            until mvn clean compile -DskipTests; do
              attempt=$((attempt + 1))
              echo "  [Run ${run_index}] Retry #${attempt}/${MAX_RETRIES}"

              if [ "$attempt" -ge "$MAX_RETRIES" ]; then
                echo "  [Run ${run_index}] Exceeded max retries (${MAX_RETRIES}). Failing job."
                exit 1
              fi
            done

            echo "  [Run ${run_index}] Build succeeded."
          done
